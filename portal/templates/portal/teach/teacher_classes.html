{% extends 'portal/teach/base.html' %}

{% block content %}

<h1>Classes</h1><br>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla quam velit, vulputate eu pharetra nec, mattis ac neque. Duis vulputate commodo lectus, ac blandit elit tincidunt id. Sed rhoncus, tortor sed eleifend tristique, tortor mauris molestie elit, et lacinia ipsum quam nec dui.</p>

<div class="section group">
    <div class="col span_1_of_2">
        <h3>Current Classes</h3>

        <table class='CSSTable'>
            <tr>
                <td>Class Name</td>
                <td>Access Code</td>
            </tr>
            {% for class in classes %}
                <tr>
                    <td><a href="{% url 'portal.views.teacher_class' class.access_code %}">{{ class.name }}</a></td>
                    <td><a href="{% url 'portal.views.teacher_class' class.access_code %}">{{ class.access_code }}</a></td>
                </tr>
            {% endfor %}
        </table>
    </div>

    <div class="col span_1_of_2">
        <div class='login-card'>
            <h3>New Class</h3><br/>

            <p>A unique Access Code will be generated for the new class.</p>

            <form method='post'>

                {% csrf_token %}

                {{ form.non_field_errors }}

                <div class="section group">
                    <div class="col span_2_of_3">
                        {{ form.name.errors }}
                        {{ form.name }}
                    </div>

                    <div class="col span_1_of_3">
                        <input type='submit' class='btn' value='Create'/>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>

<br/>

<h3>External requests to join your classes</h3>

<p>External/independent students may request to join your classes given a class Access Code from the above table and the school name ({{ user.userprofile.teacher.school.name }}), provided you have enabled external requests for that class.</p>

{% if requests %}
    <p>The following users have made requests to join your classes. If you accept a request, you will be able to choose a name that is unique for the user in the class and then pass on their new login details. At this point, you will be able to manage them like any other student.</p>

    <p><i>To conform to security models, the request user's username, last name, and email will be wiped on successful acceptance, but these details are displayed here to enable positive identification.</i></p>

    <table class="CSSTable" width='100%'>
        <tr>
            <td>Username</td>
            <td>First name</td>
            <td>Email</td>
            <td>Class</td>
            <td>Access code</td>
            <td colspan='2'>Actions</td>
        </tr>
        {% for request in requests %}
            <tr>
                <td>{{ request.user.user.username }}</td>
                <td>{{ request.user.user.first_name }}</td>
                <td>{{ request.user.user.email }}</td>
                <td>{{ request.pending_class_request.name }}</td>
                <td>{{ request.pending_class_request.access_code }}</td>
                <td><a class='btn' href="{% url 'portal.views.teacher_accept_student_request' request.id %}">Accept</a></td>
                <td><a class='btn' href="{% url 'portal.views.teacher_reject_student_request' request.id %}">Reject</a></td>
            </tr>
        {% endfor %}
    </table>
{% else %}
    <p>No students have currently requested to join your classes.</p>
{% endif %}

{% endblock %}
