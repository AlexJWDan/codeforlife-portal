{% extends "portal/teach/base.html" %}
{% load two_factor %}

{% block nav_teacher_account %}<b><a href="{% url 'portal.views.teacher_edit_account' %}">Account</a></b>{% endblock nav_teacher_account %}

{% block content %}
{% if default_device %}
<div class='section group'>
    <div class='col span_1_of_2'>
        <div class='login-card'>
            <h1>Account Security</h1><br/>

            {% if default_device_type == 'TOTPDevice' %}
                <p>Tokens will be generated by your token generator.</p>
            {% elif default_device_type == 'PhoneDevice' %}
                <p>Primary method: {{ default_device|device_action }}</p>
            {% elif default_device_type == 'RemoteYubikeyDevice' %}
                <p>Tokens will be generated by your YubiKey.</p>
            {% endif %}
        </div>

        <br/>

        <div class='login-card'>
            <h3>Disable Two-Factor Authentication</h3><br/>

            <p>However we strongly discourage you to do so, you can
                also disable two-factor authentication for your account.</p>
            <a class="btn btn-danger wide" href="{% url 'two_factor:disable' %}">
                Disable Two-Factor Authentication</a>
        </div>
    </div>

    <div class='col span_1_of_2'>
        <div class='login-card'>
            <h2>Backup Phone Numbers</h2><br/>

            <p>If your primary method is not available, we are able to
                send backup tokens to the phone numbers listed below.</p>

            {% for phone in backup_phones %}
                <form method="post" action="{% url 'two_factor:phone_delete' phone.id %}">
                    {% csrf_token %}
                    <button class="btn btn-default btn-small" type="submit">Unregister, {{ phone|device_action }}</button>
                </form>
                <br/>
            {% endfor %}

            <a class='btn btn-primary wide' href="{% url 'two_factor:phone_create' %}">Add Phone Number</a>
        </div>

        <br/>

        <div class='login-card'>
            <h2>Backup Tokens</h2><br/>
            <p>
                If you don't have any device with you, you can access
                    your account using backup tokens.
                {% if backup_tokens == 1 %} 
                    You have only one backup token remaining.
                {% else %}
                    You have {{ backup_tokens }} backup tokens remaining.
                {% endif %}
            </p>
            <a class="btn btn-primary wide" href="{% url 'two_factor:backup_tokens' %}">Show Codes</a>
        </div>
    </div>
</div>
{% else %}
    <div class='span_centered_half'>
        <div class='login-card'>
            <h1>Account Security</h1><br/>

            <p>Two-factor authentication is not enabled for your
                account. Enable two-factor authentication for enhanced account
                security.</p>

            <a class="btn btn-primary wide" href="{% url 'two_factor:setup' %}">Enable Two-Factor Authentication</a>
        </div>
    </div>
{% endif %}
{% endblock %}
