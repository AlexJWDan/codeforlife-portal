{% extends "portal/teach/base.html" %}
{% load two_factor %}

{% block nav_teacher_account %}<b><a href="{% url 'portal.views.teacher_edit_account' %}">Account</a></b>{% endblock nav_teacher_account %}

{% block content %}
{% if default_device %}
<div class='section group'>
    <div class='col span_1_of_2'>
        <div class='login-card'>
            <h1>Account Security</h1><br/>

            {% if default_device_type == 'TOTPDevice' %}
                <p>Tokens will be generated by your token generator.</p>
            {% elif default_device_type == 'PhoneDevice' %}
                <p>Primary method: {{ default_device|device_action }}</p>
            {% elif default_device_type == 'RemoteYubikeyDevice' %}
                <p>Tokens will be generated by your YubiKey.</p>
            {% endif %}
        </div>

        <br/>

        <div class='login-card'>
            <h3>Disable Two-Factor Authentication</h3><br/>

            <p>However we strongly discourage you to do so, you can
                also disable two-factor authentication for your account.</p>
            <a class="btn btn-danger wide" href="{% url 'two_factor:disable' %}">
                Disable Two-Factor Authentication</a>
        </div>
    </div>

    <div class='col span_1_of_2'>
        <div class='login-card'>
            <h2>Backup Phone Numbers</h2><br/>

            <p>If your primary method is not available, we are able to
                send backup tokens to the phone numbers listed below.</p>

            {% for phone in backup_phones %}
                <form method="post" action="{% url 'two_factor:phone_delete' phone.id %}">
                    {% csrf_token %}
                    <button class="btn btn-default btn-small" type="submit">Unregister, {{ phone|device_action }}</button>
                </form>
                <br/>
            {% endfor %}

            <a class='btn btn-primary wide' href="{% url 'two_factor:phone_create' %}">Add Phone Number</a>
        </div>

        <br/>

        <div class='login-card'>
            <h2>Backup Tokens</h2><br/>
            <p>
                If you don't have any device with you, you can access
                    your account using backup tokens.
                {% if backup_tokens == 1 %} 
                    You have only one backup token remaining.
                {% else %}
                    You have {{ backup_tokens }} backup tokens remaining.
                {% endif %}
            </p>
            <a class="btn btn-primary wide" href="{% url 'two_factor:backup_tokens' %}">Show Codes</a>
        </div>
    </div>
</div>
{% else %}
    <h1>Account</h1><br>
    <h2>Two factor authentication</h2><br>

    <h4>What is two factor authentication?</h4><br>
    <p>Two factor authentication (2FA) is a way to further protect your account by requiring two fundamentally different forms of authentication when logging in. To log in you need to provide both something you know (your password) and something you have (your smartphone or tablet).</p>

    <h4>How does two factor authentication protect me?</h4><br>
    <p>In addition to your password, your phone will generate a six digit token everytime you login to your account, providing an additional layer of security. You will have greater protection using 2FA than with a password alone. </p>

    <h4>How do I sign in with two factor authentication?</h4><br>
    <p>When you sign into the Code for Life website, you provide your email address and password. If you've opted to use 2FA, you'll be asked for your six digit token which will be generated by your smartphone or tablet. Type in the token to complete the sign in process.</p>

    <h4>What happens if I forget my smartphone or tablet? Will I be able to access my account?</h4><br>
    <p>Don't worry - you can set up backup tokens for this purpose. These tokens, each of which can only be used once, allow you to sign in without your smartphone or tablet. If you need more backup tokens, you will be able to generate them from your account settings. You should keep your backup tokens safe and stored away from any other passwords.</p>

    <h4>How do I set up two factor authentication?</h4><br>
    <div class='section group'>
        <div class='col span_1_of_3a'>
            <h4>Step 1</h4>
            <p>Get your phone ready by downloading the Google Authenticator app or equivalent onto your smartphone or tablet. (Insert some info here about what devices are supported by authenticator or equivalent). Once you've installed the app, go to Step 2.</p>
        </div>
        <div class='col span_1_of_3a'>
            <h4>Step 2</h4>
            <p>Enable two factor authentication by selecting the 'Set up Two Step Authentication' button at the bottom of the page, and scan the QR code presented.</p>
        </div>
        <div class='col span_1_of_3a'>
            <h4>Step 3</h4>
            <p>The process is complete. The next time you sign in you'll have the extra step of adding in your six digit token described under 'how do I sign in with two factor authentication'. It's that easy.</p>
        </div>
    </div>

    <a class="btn btn-default" href="{% url 'portal.views.teacher_edit_account' %}">Cancel</a>
    <a class="btn btn-primary pull-right" href="{% url 'two_factor:setup' %}">Set Up Two Factor Authentication</a>

    <!-- <div class='span_centered_half'>
        <div class='login-card'>
            <h1>Account Security</h1><br/>

            <p>Two-factor authentication is not enabled for your
                account. Enable two-factor authentication for enhanced account
                security.</p>

            <a class="btn btn-primary wide" href="{% url 'two_factor:setup' %}">Enable Two-Factor Authentication</a>
        </div>
    </div> -->
{% endif %}
{% endblock %}
